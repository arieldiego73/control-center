<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.controlcenter.controlcenter.dao.DashboardDao">

<!-- Count all the project with open status -->
    <select id="countAllOpenProject" resultType="java.lang.Integer">
        SELECT SUM(open_count) AS total_open_count
                FROM (
                    SELECT COUNT(*) AS open_count
                    FROM tbl_proj_info AS tpi
                    INNER JOIN tbl_proj_status_mst AS proj_status 
                        ON tpi.proj_status_id = proj_status.proj_status_id
                    WHERE tpi.del_flag = 0
                    AND proj_status.proj_status_name = 'Open'
                ) AS counts;
    </select>

<!-- Count all the project with close status -->
    <select id="countAllCloseProject" resultType="java.lang.Integer">
        SELECT SUM(close_count) AS total_close_count
                FROM (
                    SELECT COUNT(*) AS close_count
                    FROM tbl_proj_info AS tpi
                    INNER JOIN tbl_proj_status_mst AS proj_status 
                        ON tpi.proj_status_id = proj_status.proj_status_id
                    WHERE tpi.del_flag = 0
                    AND proj_status.proj_status_name = 'Close'
                ) AS counts;
    </select>

<!-- Count all the project with cancelled status -->
    <select id="countAllCancelledProject" resultType="java.lang.Integer">
        SELECT SUM(cancelled_count) AS total_cancelled_count
                FROM (
                    SELECT COUNT(*) AS cancelled_count
                    FROM tbl_proj_info AS tpi
                    INNER JOIN tbl_proj_status_mst AS proj_status 
                        ON tpi.proj_status_id = proj_status.proj_status_id
                    WHERE tpi.del_flag = 0
                    AND proj_status.proj_status_name = 'Cancelled'
                ) AS counts;
    </select>

    <select id="countAllRegisteredUserPerYear">
        SELECT
            YEAR(reg_date) AS year_registered,
            COUNT(*) AS user_count
        FROM
            tbl_user
        WHERE del_flag = 0
        GROUP BY
            year_registered
        ORDER BY
            year_registered;
    </select>

<!-- Count all user with business partner status -->
    <select id="countAllUserWithStatusOfBusinessPartner" resultType="java.lang.Integer">
        SELECT SUM(bp_count) AS total_bp_count
                FROM (
                    SELECT COUNT(*) AS bp_count
                    FROM tbl_user AS tuser
                    INNER JOIN tbl_status_mst AS user_status 
                        ON tuser.status_code = user_status.status_code
                    WHERE tuser.del_flag = 0
                    AND user_status.status_code = 'BP'
                ) AS counts;
    </select>

<!-- Count all user with intern status -->
    <select id="countAllUserWithStatusOfIntern" resultType="java.lang.Integer">
        SELECT SUM(int_count) AS total_int_count
                FROM (
                    SELECT COUNT(*) AS int_count
                    FROM tbl_user AS tuser
                    INNER JOIN tbl_status_mst AS user_status 
                        ON tuser.status_code = user_status.status_code
                    WHERE tuser.del_flag = 0
                    AND user_status.status_code = 'INT'
                ) AS counts;
    </select>

<!-- Count all user with regular status -->
    <select id="countAllUserWithStatusOfRegular" resultType="java.lang.Integer">
        SELECT SUM(reg_count) AS total_reg_count
                FROM (
                    SELECT COUNT(*) AS reg_count
                    FROM tbl_user AS tuser
                    INNER JOIN tbl_status_mst AS user_status 
                        ON tuser.status_code = user_status.status_code
                    WHERE tuser.del_flag = 0
                    AND user_status.status_code = 'REG'
                ) AS counts;
    </select>

<!-- Count all user with trainee status -->
    <select id="countAllUserWithStatusOfTrainee" resultType="java.lang.Integer">
        SELECT SUM(tra_count) AS total_tra_count
                FROM (
                    SELECT COUNT(*) AS tra_count
                    FROM tbl_user AS tuser
                    INNER JOIN tbl_status_mst AS user_status 
                        ON tuser.status_code = user_status.status_code
                    WHERE tuser.del_flag = 0
                    AND user_status.status_code = 'TRA'
                ) AS counts;
    </select>

    <!-- Count all the project by status -->
    <select id="countAllProjectByStatus" resultType="java.lang.Integer">
        SELECT SUM(project_count) AS total_project_count
                FROM (
                    SELECT COUNT(*) AS project_by_status_count
                    FROM tbl_proj_info AS tpi
                    INNER JOIN tbl_proj_status_mst AS proj_status 
                        ON tpi.proj_status_id = proj_status.proj_status_id
                    WHERE tpi.del_flag = 0
                    AND proj_status.proj_status_id = #{proj_status_id}
                ) AS counts;
    </select>

<!-- Count all user by status -->
    <select id="countAllUserByStatus" resultType="java.lang.Integer">
        SELECT SUM(user_count) AS total_user_count
                FROM (
                    SELECT COUNT(*) AS user_count
                    FROM tbl_user AS tuser
                    INNER JOIN tbl_status_mst AS user_status 
                        ON tuser.status_code = user_status.status_code
                    WHERE tuser.del_flag = 0
                    AND user_status.status_code = #{user_status_code}
                ) AS counts;
    </select>
    
</mapper>
